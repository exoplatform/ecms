<?xml version="1.0" encoding="ISO-8859-1"?>
<configuration
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.exoplatform.org/xml/ns/kernel_1_2.xsd http://www.exoplatform.org/xml/ns/kernel_1_2.xsd"
        xmlns="http://www.exoplatform.org/xml/ns/kernel_1_2.xsd">

    <component>
        <key>org.exoplatform.services.wcm.search.SiteSearchService</key>
        <type>org.exoplatform.services.wcm.search.SiteSearchServiceImpl</type>
        <component-plugins>
            <component-plugin>
                <name>ExcludeMimeTypes</name>
                <set-method>addExcludeIncludeDataTypePlugin</set-method>
                <type>org.exoplatform.services.wcm.search.ExcludeIncludeDataTypePlugin</type>
                <init-params>
                    <properties-param>
                        <name>search.exclude.datatypes</name>
                        <description>exclude some data type when search</description>
                        <property name="mimetypes"
                                  value="${wcm.search.excluded-mimetypes:text/css,text/javascript,application/x-javascript,text/ecmascript}"/>
                        <property name="nodetypes" value="${wcm.search.excluded-nodetypes:exo:restoreLocation}"/>
                    </properties-param>
                </init-params>
            </component-plugin>
        </component-plugins>
        <init-params>
            <value-param>
                <name>isEnabledFuzzySearch</name>
                <value>${wcm.search.enableFuzzySearch:true}</value>
            </value-param>
            <value-param>
                <name>fuzzySearchIndex</name>
                <value>${wcm.search.fuzzySearchIndex:}</value>
            </value-param>
        </init-params>
    </component>

    <component>
        <key>org.exoplatform.services.wcm.search.connector.DocumentSearchServiceConnector</key>
        <type>org.exoplatform.services.wcm.search.connector.DocumentSearchServiceConnector</type>
        <init-params>
            <properties-param>
                <name>constructor.params</name>
                <property name="searchType" value="Document"/>
                <property name="displayName" value="Document"/>
            </properties-param>
        </init-params>
    </component>

    <component>
        <type>org.exoplatform.services.wcm.search.connector.FileApplicationSearchServiceConnector</type>
        <init-params>
            <properties-param>
                <name>constructor.params</name>
                <property name="searchType" value="file"/>
                <property name="displayName" value="Files"/>
                <property name="index" value="file_alias"/>
                <property name="type" value="file"/>
                <property name="enable" value="false"/>
                <property name="titleField" value="title"/>
                <property name="searchFields" value="name,title,attachment.content"/>
            </properties-param>
        </init-params>
    </component>

    <component>
        <type>org.exoplatform.services.wcm.search.connector.FileSearchServiceConnector</type>
        <init-params>
            <properties-param>
                <name>constructor.params</name>
                <property name="searchType" value="file"/>
                <property name="displayName" value="Files"/>
                <property name="index" value="file_alias"/>
                <property name="type" value="file"/>
                <property name="enable" value="${exo.unified-search.connector.file.enable:true}"/>
                <property name="titleField" value="title"/>
                <property name="searchFields" value="name,title,attachment.content,dc:title,dc:creator,dc:subject,dc:description,dc:publisher,dc:contributor,dc:resourceType,dc:format,dc:identifier,dc:source,dc:language,dc:relation,dc:coverage,dc:rights"/>
            </properties-param>
        </init-params>
    </component>

    <component>
        <key>org.exoplatform.services.wcm.search.connector.PageSearchServiceConnector</key>
        <type>org.exoplatform.services.wcm.search.connector.PageSearchServiceConnector</type>
        <init-params>
            <properties-param>
                <name>constructor.params</name>
                <property name="searchType" value="Page"/>
                <property name="displayName" value="Page"/>
            </properties-param>
        </init-params>
    </component>

    <component>
        <type>org.exoplatform.services.wcm.search.FileESMigration</type>
    </component>

    <external-component-plugins>
        <target-component>org.exoplatform.commons.upgrade.UpgradeProductService</target-component>
        <component-plugin>
            <name>FileESMigration</name>
            <set-method>addUpgradePlugin</set-method>
            <type>org.exoplatform.services.wcm.search.FileESMigration</type>
            <description>Index all files in ES</description>
            <init-params>
                <value-param>
                    <name>product.group.id</name>
                    <description>The groupId of the product</description>
                    <value>org.exoplatform.ecms</value>
                </value-param>
                <value-param>
                    <name>plugin.execution.order</name>
                    <description>The plugin execution order</description>
                    <value>1</value>
                </value-param>
                <value-param>
                    <name>plugin.upgrade.target.version</name>
                    <description>The plugin target version</description>
                    <value>5.0.0</value>
                </value-param>
                <value-param>
                    <name>plugin.upgrade.execute.once</name>
                    <description>Should the plugin be executed only once</description>
                    <value>true</value>
                </value-param>
                <value-param>
                    <name>plugin.upgrade.async.execution</name>
                    <description>Should the plugin be executed asynchronously</description>
                    <value>true</value>
                </value-param>
            </init-params>
        </component-plugin>
    </external-component-plugins>

    <external-component-plugins>
        <target-component>org.exoplatform.commons.search.index.IndexingOperationProcessor</target-component>
        <component-plugin>
            <name>FileIndexingConnector</name>
            <set-method>addConnector</set-method>
            <type>org.exoplatform.services.wcm.search.connector.FileindexingConnector</type>
            <description>File ElasticSearch Indexing Connector</description>
            <init-params>
                <properties-param>
                    <name>constructor.params</name>
                    <property name="index_alias" value="file_alias"/>
                    <property name="index_previous" value="file"/>
                    <property name="index_current" value="file_v2"/>
                    <property name="reindexOnUpgrade" value="true"/>
                    <property name="type" value="file"/>
                </properties-param>
            </init-params>
        </component-plugin>
    </external-component-plugins>

    <external-component-plugins>
        <target-component>org.exoplatform.services.jcr.impl.ext.action.SessionActionCatalog</target-component>
        <component-plugin>
            <name>addActions</name>
            <set-method>addPlugin</set-method>
            <type>org.exoplatform.services.jcr.impl.ext.action.AddActionsPlugin</type>
            <description>add actions plugin</description>
            <init-params>
                <object-param>
                    <name>actions</name>
                    <object type="org.exoplatform.services.jcr.impl.ext.action.AddActionsPlugin$ActionsConfig">
                        <field  name="actions">
                            <collection type="java.util.ArrayList">
                                <value>
                                    <object type="org.exoplatform.services.jcr.impl.ext.action.ActionConfiguration">
                                        <field  name="workspace"><string>collaboration</string></field>
                                        <field  name="eventTypes"><string>addNode,removeNode,addProperty,changeProperty,removeProperty,changePermission</string></field>
                                        <field  name="path"><string>/</string></field>
                                        <field  name="isDeep"><boolean>true</boolean></field>
                                        <field  name="actionClassName"><string>org.exoplatform.services.wcm.search.connector.FileIndexerAction</string></field>
                                    </object>
                                </value>
                            </collection>
                        </field>
                    </object>
                </object-param>
            </init-params>
        </component-plugin>

    </external-component-plugins>

</configuration>
